import sysimport osimport astimport cProfileimport pstatsimport runpyclass FuncCollector(ast.NodeVisitor):    def __init__(self):        self.funcs = []    def visit_FunctionDef(self, node):        self.funcs.append((node.lineno, node.name))        self.generic_visit(node)    def visit_AsyncFunctionDef(self, node):        self.funcs.append((node.lineno, node.name))        self.generic_visit(node)    def visit_ClassDef(self, node):        for item in node.body:            if isinstance(item, (ast.FunctionDef, ast.AsyncFunctionDef)):                name = f"{node.name}.{item.name}"                self.funcs.append((item.lineno, name))        self.generic_visit(node)def collect_funcs(path):    with open(path, "r", encoding="utf-8") as f:        code = f.read()    tree = ast.parse(code, filename=path)    collector = FuncCollector()    collector.visit(tree)    collector.funcs.sort(key=lambda x: x[0])    return collector.funcsdef profile_file(path, args):    target = os.path.abspath(path)    sys.argv = [path] + args    pr = cProfile.Profile()    pr.enable()    runpy.run_path(target, run_name="__main__")    pr.disable()    stats = pstats.Stats(pr)    calls = {}    for (filename, lineno, funcname), data in stats.stats.items():        if os.path.abspath(filename) != target:            continue        cc, nc, tt, ct, callers = data        calls[lineno] = calls.get(lineno, 0) + nc    return callsdef main():    if len(sys.argv) < 2:        print("Usage: python run_profile_calls2.py target.py [args...]")        sys.exit(1)    target = sys.argv[1]    args = sys.argv[2:]    funcs = collect_funcs(target)    calls = profile_file(target, args)    print(f"File: {target}")    print(f"{'Line':>5} {'Function':40} {'Calls':>8}")    print("-" * 60)    for lineno, name in funcs:        count = calls.get(lineno, 0)        print(f"{lineno:5d} {name:40} {count:8d}")if __name__ == "__main__":    main()